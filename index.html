<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>My Secure TV</title>
<style>
  :root{--bg:#000;--card:#071018;--muted:rgba(255,255,255,0.65);--accent:#6fe8ff}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:system-ui,Roboto,Arial;
    background:linear-gradient(180deg,#000,#051018);
    color:#fff;
    direction:rtl
  }
  .container{max-width:980px;margin:12px auto;padding:0 12px 80px}
  .page{min-height:calc(100vh - 90px);}

  .page-title{
    margin:8px 0 10px;
    font-size:20px;
    font-weight:800;
  }

  .grid{
    display:flex;
    flex-wrap:wrap;
    gap:12px;
  }
  .card{
    width:31%;
    min-width:110px;
    background:var(--card);
    border-radius:14px;
    overflow:hidden;
    cursor:pointer;
    display:flex;
    flex-direction:column;
  }
  .thumb{
    width:100%;
    aspect-ratio:2/3;
    background:#111;
  }
  .thumb img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }
  .card-body{
    padding:6px;
  }
  .title{
    font-size:13px;
    font-weight:700;
  }
  .type-label{
    font-size:11px;
    color:var(--muted);
    margin-top:2px;
  }
  .muted{color:var(--muted);font-size:14px;margin-top:8px;}

  /* Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ */
  #playerPage{
    display:none;position:fixed;inset:0;z-index:300;
    background:#000;align-items:center;justify-content:center
  }
  #player{
    width:100%;
    max-height:100vh;
    min-height:220px;
    background:#000;
    object-fit:contain;
  }
  .player-top{
    position:absolute;top:10px;left:12px;right:12px;
    display:flex;justify-content:space-between;align-items:center;z-index:310
  }
  .player-rotate-wrap{
    position:absolute;
    bottom:20px;
    left:50%;
    transform:translateX(-50%);
    z-index:310;
  }
  .btn{
    background:rgba(255,255,255,0.06);
    color:#fff;border:none;padding:8px 10px;
    border-radius:10px;font-weight:700;cursor:pointer;
  }
  .rotate-btn{
    background:rgba(0,0,0,0.65);
    color:#fff;
    border:none;
    padding:10px 18px;
    border-radius:999px;
    font-weight:700;
    font-size:15px;
    display:flex;
    align-items:center;
    gap:6px;
    cursor:pointer;
  }

  /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ */
  .bottom-nav{
    position:fixed;left:0;right:0;bottom:0;height:68px;
    background:linear-gradient(180deg,transparent,rgba(0,0,0,0.85));
    display:flex;align-items:center;justify-content:center;z-index:320
  }
  .nav-inner{
    width:100%;max-width:980px;display:flex;
    justify-content:space-around;align-items:center;padding:8px
  }
  .tab{
    flex:1;display:flex;flex-direction:column;
    align-items:center;gap:6px;cursor:pointer
  }
  .icon-bar{
    width:34px;height:10px;background:rgba(255,255,255,0.1);border-radius:4px
  }
  .tab.active .icon-bar{background:var(--accent)}
  .label{font-size:14px;color:var(--muted)}
</style>
</head>
<body>

<main class="container">
  <div id="homePage" class="page">
    <h2 class="page-title">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
    <div id="homeGrid" class="grid"></div>
    <div id="homeMsg" class="muted"></div>
  </div>

  <div id="livePage" class="page" style="display:none">
    <h2 class="page-title">Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</h2>
    <div id="liveGrid" class="grid"></div>
    <div id="liveMsg" class="muted"></div>
  </div>

  <div id="moviesPage" class="page" style="display:none">
    <h2 class="page-title">Ø§Ù„Ø£ÙÙ„Ø§Ù…</h2>
    <div id="moviesGrid" class="grid"></div>
    <div id="moviesMsg" class="muted"></div>
  </div>

  <div id="seriesPage" class="page" style="display:none">
    <h2 class="page-title">Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª</h2>
    <div id="seriesGrid" class="grid"></div>
    <div id="seriesMsg" class="muted"></div>
  </div>
</main>

<!-- Ø§Ù„Ù…Ø´ØºÙ„ -->
<div id="playerPage">
  <div class="player-top">
    <button class="btn" onclick="closePlayer()">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
    <button class="btn" onclick="toggleCinema()">ğŸï¸</button>
  </div>
  <video id="player" controls playsinline></video>
  <div class="player-rotate-wrap">
    <button class="rotate-btn" onclick="toggleRotate()">ğŸ”„ ØªØ¯ÙˆÙŠØ±</button>
  </div>
</div>

<div class="bottom-nav">
  <div class="nav-inner" id="navInner">
    <div class="tab active" data-target="home"><div class="icon-bar"></div><div class="label">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div></div>
    <div class="tab" data-target="live"><div class="icon-bar"></div><div class="label">Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</div></div>
    <div class="tab" data-target="movies"><div class="icon-bar"></div><div class="label">Ø§Ù„Ø£ÙÙ„Ø§Ù…</div></div>
    <div class="tab" data-target="series"><div class="icon-bar"></div><div class="label">Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª</div></div>
  </div>
</div>

<script>
/* ====== Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ Ø¹Ù„Ù‰ Railway ====== */
const API_BASE = 'https://YOUR-RAILWAY-APP.up.railway.app'; // Ø¹Ø¯Ù‘Ù„ Ø¯Ù‡ Ù„Ø§Ø³Ù… Ù…Ø´Ø±ÙˆØ¹Ùƒ

/* ====== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¹Ø§Ù…Ø© ====== */
async function apiGet(path){
  const url = API_BASE.replace(/\/$/,'') + path;
  const res = await fetch(url,{cache:'no-store'});
  if(!res.ok) throw new Error('HTTP ' + res.status);
  return await res.json();
}

function createCard(item){
  const card = document.createElement('div');
  card.className = 'card';
  const thumb = document.createElement('div');
  thumb.className = 'thumb';
  const img = document.createElement('img');
  img.src = item.thumb || 'https://via.placeholder.com/320x480?text=No+Image';
  img.onerror = () => { img.src = 'https://via.placeholder.com/320x480?text=No+Image'; };
  thumb.appendChild(img);
  const body = document.createElement('div');
  body.className = 'card-body';
  const title = document.createElement('div');
  title.className = 'title';
  title.textContent = item.title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†';
  const typeLabel = document.createElement('div');
  typeLabel.className = 'type-label';
  typeLabel.textContent = item.typeLabel || '';
  body.appendChild(title);
  body.appendChild(typeLabel);
  card.appendChild(thumb);
  card.appendChild(body);
  card.addEventListener('click', () => openPlayer(item.id));
  return card;
}

/* ====== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ù…Ù† Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ ====== */

async function loadList(type){
  let grid, msg;
  if(type === 'home'){ grid = document.getElementById('homeGrid'); msg = document.getElementById('homeMsg'); }
  if(type === 'live'){ grid = document.getElementById('liveGrid'); msg = document.getElementById('liveMsg'); }
  if(type === 'movies'){ grid = document.getElementById('moviesGrid'); msg = document.getElementById('moviesMsg'); }
  if(type === 'series'){ grid = document.getElementById('seriesGrid'); msg = document.getElementById('seriesMsg'); }

  if(!grid || !msg) return;

  grid.innerHTML = '';
  msg.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';

  try{
    const data = await apiGet('/api/list?type=' + encodeURIComponent(type));
    const items = data && data.items ? data.items : [];
    if(!items.length){
      msg.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Ù…ØªØ§Ø­Ø©.';
      return;
    }
    msg.textContent = '';
    items.forEach(it => {
      grid.appendChild(createCard(it));
    });
  }catch(e){
    console.error(e);
    msg.textContent = 'ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.';
  }
}

/* ====== Ø§Ù„Ù…Ø´ØºÙ„ ====== */

const playerPage = document.getElementById('playerPage');
const playerEl = document.getElementById('player');
const bottomNav = document.querySelector('.bottom-nav');
let isRotated = false;

async function openPlayer(id){
  try{
    const data = await apiGet('/api/stream-url?id=' + encodeURIComponent(id));
    const url = data && data.url;
    if(!url){
      alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· ØªØ´ØºÙŠÙ„ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±');
      return;
    }
    playerEl.src = url;
    playerEl.load();
    await playerEl.play().catch(()=>{});
    playerPage.style.display = 'flex';
    if(bottomNav) bottomNav.style.display = 'none';
    adjustPlayerForOrientation();
  }catch(e){
    console.error(e);
    alert('ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±');
  }
}

function closePlayer(){
  try{
    playerEl.pause();
    playerEl.removeAttribute('src');
    playerEl.load();
  }catch(e){}
  playerPage.style.display = 'none';
  if(bottomNav) bottomNav.style.display = 'flex';
  document.body.style.overflow = '';
  isRotated = false;
  adjustPlayerForOrientation();
}

function toggleRotate(){
  isRotated = !isRotated;
  if(isRotated){
    document.body.style.overflow='hidden';
  }else{
    document.body.style.overflow='';
  }
  adjustPlayerForOrientation();
}

function toggleCinema(){
  if(!document.fullscreenElement) playerEl.requestFullscreen?.().catch(()=>{});
  else document.exitFullscreen?.();
}

function adjustPlayerForOrientation(){
  const isLandscape = window.innerWidth > window.innerHeight;
  if(isRotated){
    playerEl.style.width  = '100vh';
    playerEl.style.height = '100vw';
    playerEl.style.objectFit = 'cover';
    playerEl.style.transform = 'rotate(90deg)';
    playerEl.style.transformOrigin = 'center center';
    return;
  }
  if(isLandscape){
    playerEl.style.width='100vw';
    playerEl.style.height='100vh';
    playerEl.style.objectFit='cover';
    document.body.style.overflow='hidden';
  } else {
    playerEl.style.width='100%';
    playerEl.style.height='auto';
    playerEl.style.objectFit='contain';
    document.body.style.overflow='';
  }
  playerEl.style.transform='none';
  playerEl.style.transformOrigin='center center';
}

/* ====== Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª ====== */

const pages = {
  home: document.getElementById('homePage'),
  live: document.getElementById('livePage'),
  movies: document.getElementById('moviesPage'),
  series: document.getElementById('seriesPage')
};

function showPage(key){
  Object.keys(pages).forEach(k=>{
    if(!pages[k]) return;
    pages[k].style.display = (k === key ? 'block' : 'none');
  });
  window.scrollTo({top:0,behavior:'instant'});
  loadList(key === 'home' ? 'home' : key);
}

document.getElementById('navInner').addEventListener('click', (ev)=>{
  const tab = ev.target.closest('.tab'); 
  if(!tab) return;
  Array.from(document.querySelectorAll('.tab')).forEach(t=>t.classList.remove('active'));
  tab.classList.add('active');
  const target = tab.dataset.target || 'home';
  showPage(target);
});

document.addEventListener('DOMContentLoaded', ()=>{
  showPage('home');
});

window.addEventListener('resize', ()=>{ if(playerPage.style.display==='flex') adjustPlayerForOrientation(); });
window.addEventListener('orientationchange', ()=>{ if(playerPage.style.display==='flex') adjustPlayerForOrientation(); });
</script>
</body>
</html>
